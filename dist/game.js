function isPortrait(e){return e.height>e.width}var scoreText,levelText,bounds,sentenceWord,scrollPool,BASE_URL="https://micromaterials.org/api/sentence/",LINE_STOPPED_SPEED=0,LINE_STARTED_SPEED=-330,score=0,pauseFlag=!1,feature="",level=0;function playPastParticiple(){void 0,feature="past_participle",game.state.start("play")}function playSimplePast(){void 0,feature="simple_past",game.state.start("play")}function playPresentParticiple(){void 0,feature="present_participle",game.state.start("play")}function setUpPageAlignment(){game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.scale.refresh()}function preload(){}featureMap={past_participle:"VBN",comparative_adjective:"JJR",present_participle:"VBG",plural_noun:"NNS",simple_past:"VBD"};var game=function(){var e=isPortrait(screen)?.7:.75;return new Phaser.Game(.8*screen.width,screen.height*e,Phaser.CANVAS,"gameDiv",{preload:preload,create:create,update:update})}(),sentenceFactory=function(){var o={},n=-1,r=[];return o.nextSentence=function(){if(++n<r.length)return void 0,void 0,{sentence:r[n].sentence,words:r[n].words};void 0},o.loadSentences=function(e){void 0;var a=BASE_URL+feature,t=new XMLHttpRequest;t.open("GET",a),t.onload=function(){200===t.status?(n=-1,r=JSON.parse(t.response).sentences):(void 0,e(t.status,o))},t.setRequestHeader("Content-Type","application/json"),t.send()},o}();function create(){game.physics.startSystem(Phaser.Physics.ARCADE);var e=game.world.width/1200,a=game.world.height/800;game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,setUpPageAlignment();var t=game.add.tileSprite(0,0,1200,800,"background");t.tileScale.x=e,t.tileScale.y=a;game.add.tileSprite(0,game.world.height-100,1200,100,"floor");var o=game.add.sprite(game.world.width,.95*game.world.height,"conveyor");o.anchor.set(.75,.75),o.scale.setTo(e,a);var n=game.add.sprite(game.world.width,.25*game.world.height,"scaffolding");n.anchor.set(.95,.75),n.scale.setTo(e,a);var r=isPortrait(screen)?"2em Georgia":"3.5em Georgia";scoreText=game.add.text(5,5,"Points: "+score,{font:r,fill:"#000000"});var s=isPortrait(screen)?"2em Georgia":"3.5em Georgia";(levelText=game.add.text(game.world.width-5,5,"Level: "+(level+1),{font:s,fill:"#000000"})).anchor.set(1,0);var l=game.add.sprite(.15*game.world.width,.3*game.world.height,"pauseButton");l.anchor.set(.5);var i=isPortrait(screen)?.2:.35;l.scale.setTo(i),l.inputEnabled=!0,l.events.onInputDown.add(function(){pauseFlag=pauseFlag?(l.loadTexture("pauseButton"),!1):(l.loadTexture("playButton"),!0);var e=scrollPool.getFirstAlive(),a=Math.abs(e.body.velocity.x)>LINE_STOPPED_SPEED?LINE_STOPPED_SPEED:currentLevelSpeed;scrollPool.setAll("body.velocity.x",a)},this),currentLevelSpeed=LINE_STARTED_SPEED,bounds=game.add.sprite(1,.7*game.world.height,null),game.physics.enable(bounds,Phaser.Physics.ARCADE),bounds.body.immovable=!0,bounds.body.setSize(1,game.world.height,1,1);isPortrait(screen);(scrollPool=game.add.group()).enableBody=!0,scrollPool.physicsBodyType=Phaser.Physics.ARCADE,scrollPool.setAll("outOfBoundsKill",!0),sentenceFactory.loadSentences(advanceTheProductionLine)}function testWord(e,a){"changed"==e.data?(e.alpha=.5,displayCheckMark(),score+=10,scoreText.setText("Points: "+score)):speedUpLine()}function speedUpLine(){currentLevelSpeed<=-600||(currentLevelSpeed-=25,scrollPool.setAll("body.velocity.x",currentLevelSpeed))}function displayCheckMark(){if(isPortrait(screen))(e=game.add.sprite(.45*game.world.width,.28*game.world.height,"greenCheckMark")).scale.setTo(.65);else var e=game.add.sprite(.5*game.world.width,.4*game.world.height,"greenCheckMark");game.time.events.add(2e3,function(){game.add.tween(e).to({alpha:0},2e3,Phaser.Easing.Linear.None,!0)},this)}function advanceTheProductionLine(e,a){if(e)void 0;else{var t=a.nextSentence();if(t){var o=t.words;void 0;var n=!1,r=!1;positionCount=0;for(var s=isPortrait(screen)?{font:"3em Consolas",fill:"#b3h5j6"}:{font:"5em Consolas",fill:"#a4d7gg"},l=0;l<o.length;l++){if(o[l].pos==featureMap[feature]&&0==n){var i=o[l].lemma;n=!0}else i=o[l].original;if(o[l+1])var d=o[l+1].original;else d=null;sentenceWord=game.add.text(game.world.width+positionCount,.7*game.world.height,i,s,scrollPool),o[l].pos==featureMap[feature]&&0==r?(sentenceWord.data="changed",r=!0):sentenceWord.data="same",sentenceWord.body.velocity.setTo(currentLevelSpeed,0),sentenceWord.checkWorldBounds=!0,l==o.length-1&&(sentenceWord.body.onCollide=new Phaser.Signal,sentenceWord.body.onCollide.add(detectCollide,this)),sentenceWord.anchor.set(0,0),sentenceWord.inputEnabled=!0,sentenceWord.events.onInputDown.add(testWord,this),d&&(/['",\.]/.test(d[0])||/n't/.test(d))?positionCount+=sentenceWord.width:positionCount+=sentenceWord.width+10}}else game.state.start("win")}}function detectCollide(e){e.hasCollided||(e.hasCollided=!0,onEndOfTheProductionLine())}function onEndOfTheProductionLine(){scrollPool.callAll("kill"),advanceTheProductionLine(null,sentenceFactory)}function update(){game.physics.arcade.collide(sentenceWord,bounds,detectCollide)}var bootState={preload:function(){void 0,game.load.image("preloader","assets/images/loading.png"),game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0},create:function(){game.stage.backgroundColor="#000000",game.state.start("load")},start:function(){}},loadState={preload:function(){void 0,game.load.image("factoryLogo","assets/images/factoryLogo.jpg"),game.load.image("selectButton","assets/images/redSelectButton.png"),game.load.image("background","assets/images/factoryWalls.png"),game.load.image("floor","assets/images/factoryFloor.png"),game.load.image("conveyor","assets/images/conveyor.png"),game.load.image("scaffolding","assets/images/scaffolding.png"),game.load.image("pauseButton","assets/images/pauseButtonOutlined.webp"),game.load.image("playButton","assets/images/playButtonOutlined.webp"),game.load.image("greenCheckMark","assets/images/checkmark.png");var e=game.add.sprite(0,game.world.height-50,"preloader"),a=game.world.width/387;e.scale.setTo(a,1),game.add.text(game.world.centerX,game.world.height-130,"Loading...",{fill:"white"}).anchor.setTo(.5),game.load.setPreloadSprite(e)},loadUpdate:function(){100===game.load.progress&&this.loadComplete()},loadComplete:function(){game.state.start("splashScreen")}},splashScreenState={preload:function(){preload()},create:function(){game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,setUpPageAlignment();var e=isPortrait(screen)?"1.75em Georgia":"3.5em Georgia",a=game.add.sprite(game.world.centerX,game.world.centerY/2,"factoryLogo");a.anchor.set(.5);var t=game.world.width/2086*.65,o=game.world.height/2400/2*.75;a.scale.setTo(t,o),game.add.text(game.world.centerX,.75*game.world.height,"SENTENCE FACTORY",{font:e,fill:"#0095DD"}).anchor.set(.5);var n=isPortrait(screen)?"1.6em Georgia":"3em Georgia",r=game.add.text(game.world.centerX,game.world.height-35,"touch the screen to start",{font:n,fill:"#0095DD"});r.anchor.set(.5),r.alpha=1,game.add.tween(r).to({alpha:.25},300,"Linear",!0,1,-1).yoyo(!0,300),game.input.onTap.addOnce(this.start,this)},start:function(){game.state.start("instructions")}},instructionState={preload:function(){preload()},create:function(){game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,setUpPageAlignment();var e=isPortrait(screen)?"1.75em Georga":"4.5em Georgia",a=(game.add.text(15,35,instructions,{font:e,fill:"#0095DD",wordWrap:!0,wordWrapWidth:.85*game.world.width}),isPortrait(screen)?"1.5em Georgia":"2.5em Georgia"),t=isPortrait(screen)?25:50;game.add.text(game.world.centerX,game.world.height-t,"touch the screen to continue...",{font:a,fill:"#0095DD"}).anchor.set(.5),game.input.onTap.addOnce(this.start,this)},start:function(){game.state.start("select")}},selectState={preload:function(){},create:function(){game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,setUpPageAlignment();var e=isPortrait(screen)?"1.75em Georgia":"4.5em Georgia";game.add.text(game.world.width/2,35,selectionInstructions,{font:e,fill:"#0095DD",wordWrap:!0,wordWrapWidth:.9*game.world.width}).anchor.set(.5);var a=isPortrait(screen)?.35:.6,t=isPortrait(screen)?"1.2em Georgia":"2.5em Georgia",o=game.add.sprite(.5*game.world.width,.35*game.world.height,"selectButton");o.anchor.set(.5),game.add.text(.5*game.world.width,.35*game.world.height,"simple past",{font:t,fill:"#000000"}).anchor.set(.5),o.enableBody=!0,o.physicsBodyType=Phaser.Physics.ARCADE,o.inputEnabled=!0,o.events.onInputDown.add(playPastParticiple,this),o.scale.setTo(a);var n=game.add.sprite(.5*game.world.width,.55*game.world.height,"selectButton");n.anchor.set(.5),game.add.text(.5*game.world.width,.55*game.world.height,"present participle",{font:t,fill:"#000000"}).anchor.set(.5),n.enableBody=!0,n.physicsBodyType=Phaser.Physics.ARCADE,n.inputEnabled=!0,n.events.onInputDown.add(playSimplePast,this),n.scale.setTo(a);var r=game.add.sprite(.5*game.world.width,.75*game.world.height,"selectButton");r.anchor.set(.5),game.add.text(.5*game.world.width,.75*game.world.height,"past participle",{font:t,fill:"#000000"}).anchor.set(.5),r.enableBody=!0,r.physicsBodytype=Phaser.Physics.ARCADE,r.inputEnabled=!0,r.events.onInputDown.add(playPastParticiple,this),r.scale.setTo(a)},start:function(){game.state.start("play")}},playState={preload:function(){},create:function(){void 0,void 0,create()},update:function(){update()}},winState={preload:function(){},create:function(){void 0,game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,setUpPageAlignment();var e=isPortrait(screen)?"2.5em Georgia":"4.5em Georgia";game.add.text(game.world.centerX,game.world.centerY,"you got to the end of the level. Touch the screen to continue to the next level.",{font:e,fill:"#0095DD",wordWrap:!0,wordWrapWidth:.9*game.world.width,boundsAlignH:"center"}).anchor.set(.5),game.input.onTap.addOnce(this.start,this)},start:function(){game.state.start("play")}};game.state.add("boot",bootState),game.state.add("load",loadState),game.state.add("splashScreen",splashScreenState),game.state.add("instructions",instructionState),game.state.add("select",selectState),game.state.add("play",playState),game.state.add("win",winState),game.state.start("boot");